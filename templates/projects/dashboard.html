{% extends 'base.html' %}
{% load static %}

{% block title %}Tablero - CMI GAD Celica{% endblock %}

{% block content %}
<style>
    .welcome-banner {
        background: linear-gradient(90deg, #cceeff, #e6f7ff); /* Celeste degradado */
        color: #004c99;
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 25px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        font-family: 'Segoe UI', sans-serif;
        text-align: center;
    }
    .alert-card {
        background-color: #fffbea; /* Amarillo muy suave */
        border: 1px solid #ffeeba;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.08);
        font-family: 'Segoe UI', sans-serif;
    }
    .alert-card h4 {
        color: #856404;
        font-weight: bold;
        margin-bottom: 10px;
    }
    .list-group-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-family: 'Segoe UI', sans-serif;
        padding: 12px 20px;
    }
    .list-group-item a {
        text-decoration: none;
        color: #004c99;
        font-weight: 500;
    }
    .list-group-item a:hover {
        text-decoration: underline;
    }
    .btn-custom {
        font-weight: bold;
        box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        margin: 5px;
        border-radius: 25px;
        padding: 10px 20px;
        display: inline-block;
    }
    .badge-info-custom {
        background-color: #00b4d8;
        color: white;
    }
</style>

<div class="text-center mb-4">
    {% if static %}
        <img src="{% static 'projects/images/dashboard_logo.png' %}"  
             alt="Logo Tablero"  
             class="img-fluid rounded shadow-sm"  
             style="max-height:100px;">
    {% endif %}
</div>

<div class="welcome-banner">
    <h2>Â¡Bienvenido, {{ user.username }}!</h2>
    <p class="mb-0"><strong>Rol en el Sistema:</strong> {{ user_role|default:"Usuario" }}</p>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="alert-card text-center">
            <h4>Proyectos Activos</h4>
            <h2 class="display-6 fw-bold text-primary">{{ active_projects|length }}</h2>
            <hr>
            {% for project in active_projects|slice:":3" %}
                <div class="small mb-1"><a href="{% url 'project_detail' project.pk %}">{{ project.name }}</a></div>
            {% empty %}
                <p class="small italic">No hay proyectos activos.</p>
            {% endfor %}
        </div>
    </div>

    <div class="col-md-4">
        <div class="alert-card text-center">
            <h4>Tareas Pendientes</h4>
            <h2 class="display-6 fw-bold text-danger">{{ pending_tasks|length }}</h2>
            <hr>
            {% for task in pending_tasks|slice:":3" %}
                <div class="small mb-1 text-truncate">{{ task.name }}</div>
            {% empty %}
                <p class="small italic">Todo al dÃ­a.</p>
            {% endfor %}
        </div>
    </div>

    <div class="col-md-4">
        <div class="alert-card text-center">
            <h4>Ãšltimos Reportes</h4>
            <h2 class="display-6 fw-bold text-success">{{ latest_reports|length }}</h2>
            <hr>
            {% for report in latest_reports|slice:":2" %}
                <div class="small mb-1 text-truncate">
                    <strong>{{ report.proyecto.name }}</strong> ({{ report.fecha|date:"d/m/y" }})
                </div>
            {% empty %}
                <p class="small italic">Sin reportes este mes.</p>
            {% endfor %}
        </div>
    </div>
</div>

<div class="row mt-3">
    <div class="col-md-7 mb-4">
        <h3 class="text-primary fw-bold mb-3">ðŸ“‚ Listado de Proyectos</h3>
        <div class="card shadow-sm border-0">
            <ul class="list-group list-group-flush">
                {% for project in projects %}
                    <li class="list-group-item">
                        <a href="{% url 'project_detail' project.pk %}">{{ project.name }}</a>
                        <span class="badge bg-light text-dark border">{{ project.get_status_display }}</span>
                    </li>
                {% empty %}
                    <li class="list-group-item text-center py-4">
                        <p class="mb-2 text-muted">AÃºn no has creado proyectos.</p>
                        <a href="{% url 'project_create' %}" class="btn btn-sm btn-outline-primary">Crear mi primer proyecto</a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div class="col-md-5 mb-4">
        <h3 class="text-warning fw-bold mb-3">âš¡ Acciones RÃ¡pidas</h3>
        <div class="d-grid gap-2">
            <a href="{% url 'project_create' %}" class="btn btn-info text-dark btn-custom">
                âž• Nuevo Proyecto
            </a>
            <a href="{% url 'activity_create' %}" class="btn btn-secondary text-white btn-custom">
                ðŸ“Œ Agregar Actividad
            </a>
            <a href="{% url 'milestone_create' %}" class="btn btn-primary text-white btn-custom">
                ðŸŽ¯ Registrar Hito
            </a>
            <a href="{% url 'seguimiento_list' %}" class="btn btn-warning text-dark btn-custom">
                ðŸ“Š GestiÃ³n de Seguimientos
            </a>
        </div>
    </div>
</div>
{% endblock %}