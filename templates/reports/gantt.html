{% extends 'base.html' %}
{% load static %}

{% block content %}
<script src="https://code.highcharts.com/highcharts-gantt.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>

<div class="container-fluid my-5 px-4">
    <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
        <div class="p-4 text-white" style="background: linear-gradient(135deg, #004c99 0%, #007bff 100%);">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="fw-bold mb-1">Diagrama de Gantt</h2>
                    <p class="mb-0 opacity-75">Cronograma detallado del proyecto: <strong>{{ proyecto.name }}</strong></p>
                </div>
                <a href="{% url 'reports:report_list' %}" class="btn btn-light btn-sm rounded-pill px-3 fw-bold">
                    <i class="fas fa-arrow-left me-2"></i>Volver
                </a>
            </div>
        </div>

        <div class="card-body p-0">
            <div id="container" style="width:100%; height: 500px;"></div>
        </div>

        <div class="card-footer bg-white py-3 border-0">
            <div class="row text-center">
                <div class="col-md-4">
                    <small class="text-muted d-block">Estado del Proyecto</small>
                    <span class="badge bg-info text-dark rounded-pill">{{ proyecto.get_status_display }}</span>
                </div>
                <div class="col-md-4">
                    <small class="text-muted d-block">Total Actividades</small>
                    <span class="fw-bold">{{ actividades.count }}</span>
                </div>
                <div class="col-md-4">
                    <small class="text-muted d-block">Exportar</small>
                    <button onclick="window.print()" class="btn btn-link btn-sm text-decoration-none text-primary">Imprimir Reporte</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Configuración de Highcharts Gantt
    Highcharts.ganttChart('container', {
        title: { text: null }, // Quitamos título interno para usar el del card
        chart: {
            style: { fontFamily: "'Segoe UI', Roboto, sans-serif" }
        },
        plotOptions: {
            gantt: {
                borderRadius: 4,
                borderWidth: 0,
                grouping: true,
                dataLabels: { enabled: true, style: { fontWeight: 'normal', textOutline: 'none' } }
            }
        },
        xAxis: [{
            gridLineWidth: 1,
            labels: { style: { color: '#666' } }
        }],
        yAxis: {
            labels: {
                style: { fontWeight: 'bold', fontSize: '13px', color: '#333' }
            }
        },
        tooltip: {
            pointFormat: '<span>Inicio: {point.start:%e %b %Y}</span><br/><span>Fin: {point.end:%e %b %Y}</span>'
        },
        series: [{
            name: '{{ proyecto.name }}',
            data: [
                {% if actividades %}
                    {% for actividad in actividades %}
                    {
                        name: '{{ actividad.name }}',
                        id: 'act_{{ actividad.id }}',
                        start: Date.UTC({{ actividad.start_date.year }}, {{ actividad.start_date.month|add:-1 }}, {{ actividad.start_date.day }}),
                        end: Date.UTC({{ actividad.end_date.year }}, {{ actividad.end_date.month|add:-1 }}, {{ actividad.end_date.day }}),
                        color: '#007bff', // Color moderno
                        {% if forloop.first %}current: true{% endif %}
                    }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                {% endif %}
            ]
        }],
        credits: { enabled: false }, // Quitamos la marca de agua
        exporting: { enabled: true } // Permite descargar como imagen
    });
</script>

<style>
    body { background-color: #f8f9fa; }
    .card { transition: transform 0.2s; }
</style>
{% endblock %}